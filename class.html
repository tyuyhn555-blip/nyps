<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>ç­ç´šç§©åºç®¡ç†ç³»çµ±</title>
    <style>
        :root { --primary: #4a90e2; --green: #2ecc71; --yellow: #f1c40f; --red: #e74c3c; --bg: #f8f9fa; }
        body { font-family: "Microsoft JhengHei", sans-serif; background: var(--bg); display: flex; flex-direction: column; align-items: center; padding: 20px; }
        
        /* å¯†ç¢¼ç™»å…¥å€æ¨£å¼ */
        #login-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #fff; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 1000; }
        .login-box { padding: 30px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); text-align: center; }
        input[type="password"] { padding: 10px; font-size: 18px; border: 2px solid #ddd; border-radius: 5px; margin-bottom: 10px; }
        
        /* ä¸»ç¶²é æ¨£å¼ */
        .tabs { margin-bottom: 20px; }
        .tab-btn { padding: 12px 25px; font-size: 18px; cursor: pointer; border: none; background: #ddd; margin: 0 5px; border-radius: 8px; transition: 0.3s; }
        .tab-btn.active { background: var(--primary); color: white; box-shadow: 0 4px 10px rgba(74,144,226,0.3); }
        .class-panel { background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 450px; text-align: center; display: none; }
        .class-panel.active { display: block; }
        .timer { font-size: 60px; font-weight: bold; color: #333; margin: 15px 0; font-family: monospace; }
        .score-display { font-size: 22px; margin-bottom: 25px; color: #555; background: #f0f7ff; padding: 10px; border-radius: 10px; }
        .traffic-light { display: flex; justify-content: space-around; background: #333; padding: 25px; border-radius: 25px; }
        .light { width: 90px; height: 90px; border-radius: 50%; cursor: pointer; opacity: 0.2; transition: 0.2s; border: 4px solid rgba(255,255,255,0.1); }
        .green { background-color: var(--green); box-shadow: 0 0 25px var(--green); }
        .yellow { background-color: var(--yellow); box-shadow: 0 0 25px var(--yellow); }
        .red { background-color: var(--red); box-shadow: 0 0 25px var(--red); }
        .light.active { opacity: 1; }
        .btn-group button { padding: 8px 18px; cursor: pointer; margin: 5px; border-radius: 5px; border: 1px solid #ccc; background: white; }
        .status-tag { font-size: 12px; color: #999; margin-top: 15px; }
    </style>
</head>
<body>

    <div id="login-overlay">
        <div class="login-box">
            <h2 style="color: #444;">ğŸ”‘ è«‹è¼¸å…¥ç®¡ç†å¯†ç¢¼</h2>
            <input type="password" id="password-input" placeholder="è«‹è¼¸å…¥å¯†ç¢¼">
            <br>
            <button class="tab-btn active" onclick="checkPassword()">ç™»å…¥ç³»çµ±</button>
            <p id="login-msg" style="color: red; margin-top: 10px;"></p>
        </div>
    </div>

    <h2 id="main-title" style="color: #444; margin-bottom: 10px;">ğŸŒŸ ç­ç´šç§©åºé›²ç«¯ç®¡ç†ç³»çµ±</h2>

    <div class="tabs" id="tabs">
        <button class="tab-btn active" onclick="showClass('502')">502</button>
        <button class="tab-btn" onclick="showClass('503')">503</button>
        <button class="tab-btn" onclick="showClass('504')">504</button>
        <button class="tab-btn" onclick="showClass('505')">505</button>
        <button class="tab-btn" onclick="showClass('506')">506</button>
    </div>

    <div id="panels-container"></div>

    <script>
        // ã€é‡è¦ã€‘è«‹åœ¨ä¸‹æ–¹çš„å–®å¼•è™Ÿä¸­è²¼ä¸Šä½ çš„ Google Apps Script ç¶²å€
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxmg4eK60xWb7Gz1DMA5QhknkcwxFHGi3PtTEiNIOfL-_x_CoDjsJuN3CYQlTYT6y7xIw/exec'; 

        const classes = ['502', '503', '504', '505', '506'];
        let timers = {};
        let scores = {};

        // å¯†ç¢¼æª¢æŸ¥
        function checkPassword() {
            const input = document.getElementById('password-input').value;
            if (input === 'ringoapple') {
                document.getElementById('login-overlay').style.display = 'none';
            } else {
                document.getElementById('login-msg').innerText = 'å¯†ç¢¼éŒ¯èª¤ï¼Œè«‹é‡æ–°è¼¸å…¥';
            }
        }

        // åˆå§‹åŒ–é é¢
        function init() {
            const container = document.getElementById('panels-container');
            classes.forEach(cls => {
                scores[cls] = { current: 0 };
                timers[cls] = { totalSeconds: 0, sessionSeconds: 0, interval: null };

                const panel = document.createElement('div');
                panel.id = `panel-${cls}`;
                panel.className = `class-panel ${cls === '502' ? 'active' : ''}`;
                panel.innerHTML = `
                    <div style="font-size: 1.2rem; color: #888;">æ­£åœ¨ç®¡ç†ï¼š${cls} ç­</div>
                    <div class="timer" id="timer-${cls}">00:00</div>
                    <div class="btn-group">
                        <button onclick="startTimer('${cls}')">â–¶ é–‹å§‹è¨ˆæ™‚</button>
                        <button onclick="stopTimer('${cls}')">â¸ æš«åœä¸¦åŒæ­¥</button>
                        <button onclick="resetTimer('${cls}')">ğŸ”„ é‡è¨­</button>
                    </div>
                    <hr style="margin: 20px 0; border: 0; border-top: 1px solid #eee;">
                    <div class="score-display">æœ¬æ¬¡èª²å ‚è©•åˆ†ï¼š<span id="current-${cls}" style="font-weight:bold; color:var(--primary)">0</span></div>
                    <div class="traffic-light">
                        <div class="light red" onclick="updateScore('${cls}', -1)"></div>
                        <div class="light yellow" onclick="updateScore('${cls}', 0)"></div>
                        <div class="light green" onclick="updateScore('${cls}', 1)"></div>
                    </div>
                    <div class="status-tag" id="status-${cls}">é›²ç«¯åŒæ­¥å·²å°±ç·’</div>
                `;
                container.appendChild(panel);
            });
        }

        function showClass(cls) {
            classes.forEach(c => { if(timers[c].interval) stopTimer(c); });
            document.querySelectorAll('.class-panel').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`panel-${cls}`).classList.add('active');
            event.currentTarget.classList.add('active');
        }

        function startTimer(cls) {
            if (timers[cls].interval) return;
            timers[cls].interval = setInterval(() => {
                timers[cls].totalSeconds++;
                timers[cls].sessionSeconds++;
                updateTimerDisplay(cls);
            }, 1000);
        }

        function stopTimer(cls) {
            if (!timers[cls].interval) return;
            clearInterval(timers[cls].interval);
            timers[cls].interval = null;
            if (timers[cls].sessionSeconds > 0) {
                syncToCloud(cls, "time", timers[cls].sessionSeconds);
                timers[cls].sessionSeconds = 0;
            }
        }

        function resetTimer(cls) {
            stopTimer(cls);
            timers[cls].totalSeconds = 0;
            updateTimerDisplay(cls);
        }

        function updateTimerDisplay(cls) {
            const min = Math.floor(timers[cls].totalSeconds / 60).toString().padStart(2, '0');
            const sec = (timers[cls].totalSeconds % 60).toString().padStart(2, '0');
            document.getElementById(`timer-${cls}`).innerText = `${min}:${sec}`;
        }

        function updateScore(cls, value) {
            scores[cls].current += value;
            document.getElementById(`current-${cls}`).innerText = scores[cls].current;
            syncToCloud(cls, "score", value);
            const panel = document.getElementById(`panel-${cls}`);
            const lights = panel.querySelectorAll('.light');
            lights.forEach(l => l.classList.remove('active'));
            if(value === 1) lights[2].classList.add('active');
            else if(value === 0) lights[1].classList.add('active');
            else if(value === -1) lights[0].classList.add('active');
            setTimeout(() => lights.forEach(l => l.classList.remove('active')), 600);
        }

        function syncToCloud(cls, type, val) {
            const statusEl = document.getElementById(`status-${cls}`);
            if(statusEl) statusEl.innerText = "åŒæ­¥ä¸­...";
            fetch(SCRIPT_URL, {
                method: "POST",
                mode: 'no-cors',
                body: JSON.stringify({ "class": cls, "type": type, "value": val })
            }).then(() => {
                if(statusEl) statusEl.innerText = "é›²ç«¯åŒæ­¥æˆåŠŸ";
            }).catch(() => {
                if(statusEl) statusEl.innerText = "åŒæ­¥å¤±æ•—";
            });
        }

        init();
    </script>
</body>
</html>